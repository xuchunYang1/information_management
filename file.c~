#include "file.h"
#include "msg_list.h"

extern employee_info_t *head;

void load_file_toList()
{
	int ret = 0;
	employee_info_t *data_read = NULL;
	
	FILE *fp_data_read = fopen(MYFILE, "rb");
	if (!fp_data_read)
	{	
		//char cmd[50];
		//printf("file %s is not exist, now creat it\n", FILE);
		//sprintf(cmd, "touch %s", FILE);
		//system(cmd);
		printf("文件打开失败！！！\n");
		exit(1);
	}
		
	while (!feof(fp_data_read))
	{
		data_read = malloc(sizeof(employee_info_t));
		ret = fread(data_read, sizeof(employee_info_t), 1, fp_data_read);
		//printf("%s\t%d\t%s\t%s\t\n", data_read->name, data_read->age, data_read->sex, data_read->phone);
		if (data_read->age != 0)
		{
			insert_node(data_read);
		}
	}
	
	traverse();	
	fclose(fp_data_read);
}

void save_list_toFile()
{	
	int ret = 0;
	employee_info_t *p = head;
	
	FILE *fp_data_write = fopen(MYFILE, "wb");
	if (!fp_data_write)
	{
		printf("文件打开失败！！！\n");
		exit(1);
	}
	
	while (p != NULL)
	{
		ret = fwrite(p , sizeof(employee_info_t), 1, fp_data_write);
		p = p->next;
	}

	fclose(fp_data_write);	
}
